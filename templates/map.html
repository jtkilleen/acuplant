<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">

    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }

      #map {
        margin-top: -10%;
        height: 90%;
      }

      button {
        width: 90px;
      }

      @media only screen and (max-device-width : 667px) {
        #map {
           margin-top: -5%;
           height: 90%;
        }
      }

    </style>
  </head>
  <body>
    <nav class="navbar navbar-default">
  <div class="container-fluid">
    <!-- Brand and toggle get grouped for better mobile display -->
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="#">Flower Power</a>
    </div>

    <!-- Collect the nav links, forms, and other content for toggling -->
    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Settings <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="#">Action</a></li>
            <li><a href="#">Another action</a></li>
            <li><a href="#">Something else here</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">Separated link</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="#">One more separated link</a></li>
          </ul>
        </li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
        {% if not session.logged_in %}
        <a href="{{ url_for('login') }}">Log In</a>
        {% else %}
        <a href="{{ url_for('logout') }}">Log Out</a>
        {% endif %}
          <!-- <a href="/logout">Logout</a> -->
          </li>
      </ul>
    </div><!-- /.navbar-collapse -->
  </div><!-- /.container-fluid -->
</nav>
    <div id="map"></div>
    <script>

var map;
var acu = {lat: 32.469895, lng: -99.707831};

/**
 * The CenterControl adds a control to the map that recenters the map on Chicago.
 * This constructor takes the control DIV as an argument.
 * @constructor
 */
function CenterControl(controlDiv, map) {

  // Set CSS for the control border.
  var controlUI = document.createElement('div');
  controlUI.style.backgroundColor = '#fff';
  controlUI.style.border = '2px solid #fff';
  controlUI.style.borderRadius = '3px';
  controlUI.style.boxShadow = '0 2px 6px rgba(0,0,0,.3)';
  controlUI.style.cursor = 'pointer';
  controlUI.style.marginBottom = '22px';
  controlUI.style.textAlign = 'center';
  controlUI.title = 'Click to recenter the map';
  controlDiv.appendChild(controlUI);

  // Set CSS for the control interior.
  var controlText = document.createElement('div');
  controlText.style.color = 'rgb(25,25,25)';
  controlText.style.fontFamily = 'Roboto,Arial,sans-serif';
  controlText.style.fontSize = '16px';
  controlText.style.lineHeight = '38px';
  controlText.style.paddingLeft = '5px';
  controlText.style.paddingRight = '5px';
  controlText.innerHTML = 'Center Map';
  controlUI.appendChild(controlText);

  // Setup the click event listeners: simply set the map to Chicago.
  controlUI.addEventListener('click', function() {
    map.setCenter(acu);
  });

}
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: acu,
    zoom: 16
  });

  var centerControlDiv = document.createElement('div');
  var centerControl = new CenterControl(centerControlDiv, map);

  centerControlDiv.index = 1;
  map.controls[google.maps.ControlPosition.TOP_CENTER].push(centerControlDiv);

  var contentString = "<form id='addTree' class=add-entry onSubmit='return send();'><select name='select'>";
  {% for entry in entries %}
  contentString += "<option value='{{entry.title}}'>{{entry.title}}</option>";
  {% endfor %}
  contentString += "</select><input type='hidden' name='latitude' value="+acu.lat+"></input>";
  contentString += "<input type='hidden' name='longitude' value="+acu.lng+"></input>"
  contentString += "<br><br><button value='submit'>Submit</button></form>";
  var infowindow = new google.maps.InfoWindow({
    content: contentString
  });

  var icon = {
    url: "static/Tree.png", // url
    scaledSize: new google.maps.Size(50, 50), // scaled size
    origin: new google.maps.Point(0,0), // origin
    anchor: new google.maps.Point(0, 0) // anchor
};

  var marker = new google.maps.Marker({
    position: acu,
    map: map,
    icon: icon,
    title: 'ACU'
  });


  marker.addListener('click', function() {
    infowindow.open(map, marker);
  });

  map.addListener('click', function(e) {
    placeTree(e.latLng, map);
  });

  var positionlist = []
  {% for plant in plants %}
  // var newmarker = new google.maps.Marker({
  //   position: {lat: Number({{plant.xCoord}}), lng: Number({{plant.yCoord}})},
  //   map: map,
  //   icon: icon,
  //   title: "{{plant.id}}"
  // });

  // newmarker.addListener('click', function(){
  //   infowindow.open(map, newmarker);
  // });
  positionlist.push({lat: Number({{plant.xCoord}}), lng: Number({{plant.yCoord}})});
  {% endfor %}
  for(var i = 0; i < positionlist.length; i++)
  {
    var newmarker = new google.maps.Marker({
      position: positionlist[i],
      map: map,
      icon: icon,
      title: "Tree"
    });

    var cString = "<form id='addTree' class=add-entry onSubmit='return send();'><select name='select'>";
    {% for entry in entries %}
    cString += "<option value='{{entry.title}}'>{{entry.title}}</option>";
    {% endfor %}
    cString += "</select><input type='hidden' name='latitude' value="+positionlist[i].lat+"></input>";
    cString += "<input type='hidden' name='longitude' value="+positionlist[i].lng+"></input>"
    cString += "<br><br><button value='submit'>Submit</button></form>";
    var infowindow = new google.maps.InfoWindow({
      content: cString
    });

    newmarker.addListener('click', function(){
      infowindow.open(map, this);
    })
  }

}

function placeTree(latLng, map)
{

  var icon = {
    url: "static/Tree.png", // url
    scaledSize: new google.maps.Size(50, 50), // scaled size
    origin: new google.maps.Point(0,0), // origin
    anchor: new google.maps.Point(25,25) // anchor
};
  var marker = new google.maps.Marker({
    position: latLng,
    icon: icon,
    map: map
  });

  var contentString = "<form id='addTree' class=add-entry onSubmit='return send();'><select name='select'>";
  {% for entry in entries %}
  contentString += "<option value='{{entry.title}}'>{{entry.title}}</option>";
  {% endfor %}
  contentString += "</select><input type='hidden' name='latitude' value="+latLng.lat()+"></input>";
  contentString += "<input type='hidden' name='longitude' value="+latLng.lng()+"></input>";
  contentString += "<br><br><button value='submit'></button></form>";
  var infowindow = new google.maps.InfoWindow({
    content: contentString
  });

  marker.addListener('click', function() {
    infowindow.open(map, marker);
  });
}

function send()
{
  $.ajax({
      type: "POST",
      url: "/",
      data: $("#addTree").serialize(),
      success: function(data){
        alert("SENT");
      }
    });
  return false;
}


    </script>
    <script src="https://maps.googleapis.com/maps/api/js?callback=initMap"
        async defer></script>
  </body>
</html>